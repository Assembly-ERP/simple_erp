/ app/views/operational_portal/support_tickets/show.html.erb
%h1 Support Ticket Details
%p
  %strong Ticket ID:
  = @support_ticket.id
%p
  %strong Title:
  = @support_ticket.title
%p
  %strong Status:
  = @support_ticket.status
%p
  %strong Created At:
  = @support_ticket.created_at.strftime("%B %d, %Y %H:%M")
%h2 Messages
%ul
  - if @support_ticket.support_ticket_messages.any?
    - @support_ticket.support_ticket_messages.each do |support_ticket_message|
      %li{:style => "margin-bottom: 1em;"}
        %strong Message Added:
        = support_ticket_message.created_at.strftime("%B %d, %Y %H:%M")
        %div
          %strong Message:
          = support_ticket_message.body
        - if support_ticket_message.file.attached?
          %div
            %strong File:
            = support_ticket_message.file.filename.to_s
            %div
              = link_to "Preview", preview_message_file_operational_portal_support_ticket_path(@support_ticket, message_id: support_ticket_message.id), class: "preview-button", data: { turbo_frame: "preview-frame" }
              = link_to "Download", rails_blob_path(support_ticket_message.file, disposition: "attachment")
  - else
    %li No messages found.
%hr{:style => "margin: 2em 0;"}/
- if current_user.role == 'admin' || current_user.role == 'manager'
  %h3 Add a New Message
  = form_with model: [@support_ticket, SupportTicketMessage.new], url: add_message_operational_portal_support_ticket_path(@support_ticket), local: true, html: { multipart: true } do |form|
    .field
      = form.label :body, "Message"
      = form.text_area :body
    .field
      = form.label :file, "File"
      = form.file_field :file
    %div
      = form.submit "Add Message", class: "btn btn-primary"
= link_to 'Back to Tickets', operational_portal_support_tickets_path, class: 'btn btn-secondary'
#preview-modal.modal{"data-controller" => "modal", "data-modal-target" => "modal"}
  .modal-content{"data-modal-target" => "file"}
    %span.close{"data-action" => "click->modal#close"} Ã—
    #preview-content
      = turbo_frame_tag "preview-frame", data: { action: "turbo:frame-load->modal" } do
        / The preview content will be loaded here
  .spinner-container{"data-modal-target" => "spinner"}
    .spinner
