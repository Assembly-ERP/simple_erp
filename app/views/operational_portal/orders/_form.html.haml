= form_with(model: @order, url: path, html: {class: "grid gap-5", data: {controller: "orders--form unsaved-changes", action: ' beforeunload@window->unsaved-changes#leavingPage turbo:before-visit@document->unsaved-changes#leavingPage', changed: @order.errors.any? ? "true" : "false"}}) do |form|
  - if @order.errors.any?
    = render ErrorCardComponent.new errors: @order.errors.full_messages, label: "Validations"
  = render "form_head_inputs", form: form
  = render "form_shipping_address", form: form
  = render "search"
  %template{data: {"orders--form-target": "template"}}
    = form.fields_for :order_details, OrderDetail.new, child_index: 'NEW_RECORD' do |od_form|
      = render "item", name: "{{name}}", quantity: "{{quantity}}", price: "{{price}}", part_id: "{{part-id}}", product_id: "{{product-id}}", type: "{{type}}", id: "{{id}}", item_id: "{{item-id}}", item_price: "{{item-price}}", f: od_form
  .flex.w-full.gap-5.mt-2
    = render "form_order_items", form: form
    = render "order_summary", form: form
  .flex
    - if @order.new_record? || can?(:update, @order)
      = form.submit @order.new_record? ? "Save Order" : "Update Order", class: "btn-md bg-[color:var(--primary)] text-[color:var(--primary-text)]", "data-action": "unsaved-changes#reset"
