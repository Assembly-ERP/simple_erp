= form_with(model: @order, url: path, html: {class: "grid gap-5", data: {controller: "orders--form"}}) do |form|
  - if @order.errors.any?
    = render ErrorCardComponent.new errors: @order.errors.full_messages, label: "Validations"
  - if @order.new_record?
    .grid.grid-cols-2.gap-4
      .field
        = form.label :customer_id, "Select Customer"
        = form.collection_select :customer_id, Customer.all, :id, :name, {prompt: '--Select Customer--'}, {required: true, class: "input-primary", "data-action": "change->orders--form#customerChange"}
      = form.fields_for :order_assignee, OrderAssignee.new do |os|
        .field
          = os.label :user_id, "Select Assignee"
          = os.collection_select :user_id, [], :id, :name, {prompt: '--Select User--'}, {"data-orders--form-target": "userAssignee", "data-url": users_operational_portal_customer_url(id: ":id"), disabled: true, class: "input-primary"}
    = form.hidden_field :order_status_id, value: OrderStatus.operation_default_id
  - else
    .grid.grid-cols-4.gap-5
      .bg-white.rounded-lg.border.px-4.py-5.border-gray-300
        %h6.font-normal.text-gray-500.mb-1
          Customer
        .flex.gap-2.items-center.hover:underline
          = icon("fa-solid", "shop", class: "text-gray-600")
          %span.font-medium.text-gray-900
            = @order.customer.name
      .bg-white.rounded-lg.border.px-4.py-5.border-gray-300
        .flex.gap-3.mb-1.items-center.mb-1
          %h6.font-normal.text-gray-500
            Assignee
          %button.text-gray-400.transition-colors{type: "button", class: "hover:text-[var(--primary)]"}
            = icon("fa-solid", "pen-to-square")
        .flex.gap-2.items-center
          = icon("fa-solid", "user", class: "text-gray-600 mb-0.5")
          .font-medium.text-gray-900
            - if @order.order_assignee.present?
              = @order.order_assignee.user.name
            - else
              N/A
      .bg-white.rounded-lg.border.px-4.py-5.border-gray-300
        .flex.gap-3.mb-1.items-center.mb-1
          %h6.font-normal.text-gray-500
            Status
          %button.text-gray-400.transition-colors{type: "button", class: "hover:text-[var(--primary)]"}
            = icon("fa-solid", "pen-to-square")
        .flex.gap-2.items-center.hover:underline
          = icon("fa-solid", "chart-simple", class: "text-gray-600")
          %span.font-medium.text-gray-900
            = @order.order_status.name
      .bg-white.rounded-lg.border.px-4.py-5.border-gray-300
        .flex.gap-3.mb-1.items-center.mb-1
          %h6.font-normal.text-gray-500
            Shipping Details
          %button.text-gray-400.transition-colors{type: "button", class: "hover:text-[var(--primary)]"}
            = icon("fa-solid", "pen-to-square")
        .flex.gap-2.items-center.hover:underline
          = icon("fa-solid", "location-dot", class: "text-gray-600")
          %span.font-medium.text-gray-900
            N/A
  - if @order.new_record? || can?(:update, @order)
    = render "search"
  %template{data: {"orders--form-target": "template"}}
    = form.fields_for :order_details, OrderDetail.new, child_index: 'NEW_RECORD' do |od_form|
      = render "item", name: "{{name}}", quantity: "{{quantity}}", price: "{{price}}", part_id: "{{part-id}}", product_id: "{{product-id}}", type: "{{type}}", id: "{{id}}", item_id: "{{item-id}}", item_price: "{{item-price}}", f: od_form
  - order_details = @order.order_details.with_part_and_product
  .flex.w-full.gap-5.mt-2
    .px-4.py-5.w-full.min-h-80.border.border-gray-300.rounded.bg-white.w-full
      .divide-y.flex.flex-col.w-full{data: { "orders--form-target": "addedItems"}}
        = form.fields_for :order_details, order_details do |od_form|
          = render "item", name: od_form.object.product_id ? od_form.object.product_name : od_form.object.part_name , quantity: od_form.object.quantity, price: od_form.object.price, part_id: od_form.object.part_id, product_id: od_form.object.product_id, id: od_form.object.id, item_id: od_form.object.product_id || od_form.object.part_id, type: od_form.object.product_id ? "product" : "part", item_price: od_form.object.price, f: od_form
        .hidden{data: {"orders--form-target": "target"}}
      .grid.w-full.h-64.place-items-center{data: {"orders--form-target": "empty"}, class: order_details.present? ? "hidden" : "" }
        .flex.flex-col.gap-1.items-center.text-gray-400
          = icon("fa-solid", "box-open", class: "text-5xl")
          %span
            Add at least one item
    = render "order_summary", form: form
  .flex
    - if @order.new_record? || can?(:update, @order)
      = form.submit @order.new_record? ? "Save Order" : "Update Order", class: "btn-md bg-[color:var(--primary)] text-[color:var(--primary-text)]"
