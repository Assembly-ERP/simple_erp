<!-- app/views/operational_portal/customers/edit.html.erb -->
<div class="container">
  <h1>Edit Customer</h1>

  <%= form_with(model: @customer, url: operational_portal_customer_path(@customer), local: true) do |form| %>
    <% if @customer.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@customer.errors.count, "error") %> prohibited this customer from being saved:</h2>
        <ul>
          <% @customer.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="field">
      <%= form.label :name %>
      <%= form.text_field :name %>
    </div>

    <div class="field">
      <%= form.label :phone %>
      <%= form.telephone_field :phone, value: format_phone_number(@customer.phone) %>
    </div>

    <div class="field">
      <%= form.label :street %>
      <%= form.text_field :street %>
    </div>

    <div class="field">
      <%= form.label :city %>
      <%= form.text_field :city %>
    </div>

    <div class="field">
      <%= form.label :state %>
      <%= form.text_field :state %>
    </div>

    <div class="field">
      <%= form.label :postal_code %>
      <%= form.text_field :postal_code %>
    </div>

    <div class="field">
      <%= form.label :discount %>
      <%= form.number_field :discount, value: format('%.2f', @customer.discount.to_f), step: '0.01' %>
    </div>

    <div>
      <%= form.submit "Update Customer", class: "btn btn-primary" %>
      <%= link_to 'Back', operational_portal_customers_path, class: 'btn btn-secondary' %>
      
    </div>
  <% end %>

  <h2>Associated Users</h2>
  <ul>
    <% @users.each do |user| %>
      <li><%= link_to user.name, edit_operational_portal_user_path(user) %></li>
    <% end %>
  </ul>

  
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const phoneInput = document.querySelector('input[type="tel"]');

  if (phoneInput) {
    phoneInput.addEventListener("input", formatPhoneNumber);
  }
});

function formatPhoneNumber(event) {
  const input = event.target;
  let value = input.value.replace(/\D/g, '');

  if (value.length > 10) {
    value = value.slice(0, 10);
  }

  const formattedValue = value.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
  input.value = formattedValue;
}
</script>