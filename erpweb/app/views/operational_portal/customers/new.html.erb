<!-- app/views/operational_portal/customers/new.html.erb -->
<div class="container">
  <h1>New Customer</h1>

  <%= form_with(model: @customer, url: operational_portal_customers_path, local: true) do |form| %>
    <% if @customer.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@customer.errors.count, "error") %> prohibited this customer from being saved:</h2>
        <ul>
          <% @customer.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="field">
      <%= form.label :name %>
      <%= form.text_field :name %>
    </div>

    <div class="field">
      <%= form.label :phone %>
      <%= form.telephone_field :phone %>
    </div>

    <div class="field">
      <%= form.label :street %>
      <%= form.text_field :street %>
    </div>

    <div class="field">
      <%= form.label :city %>
      <%= form.text_field :city %>
    </div>

    <div class="field">
      <%= form.label :state %>
      <%= form.text_field :state %>
    </div>

    <div class="field">
      <%= form.label :postal_code %>
      <%= form.text_field :postal_code %>
    </div>

    <div class="field">
      <%= form.label :discount, "Discount %" %>
      <%= form.number_field :discount, value: format('%.2f', @customer.discount.to_f), step: '0.01' %>
    </div>

    <div>
      <%= form.submit "Save Customer", class: "btn" %>
      <%= link_to 'Back', operational_portal_customers_path, class: "btn btn-secondary" %>
    </div>
  <% end %>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const phoneInput = document.querySelector('input[type="tel"]');

  if (phoneInput) {
    phoneInput.addEventListener("input", formatPhoneNumber);
  }
});

function formatPhoneNumber(event) {
  const input = event.target;
  let value = input.value.replace(/\D/g, '');

  if (value.length > 10) {
    value = value.slice(0, 10);
  }

  const formattedValue = value.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
  input.value = formattedValue;
}
</script>